
#  Scenario: 
#      - your client has a subscription to a swing trading newsletter
#      - every week the client gets an email with list of trades
#      - the client track their trades in a spreadsheet ans every week they have to copy the
#        trades from the email into their tracking spreadsheet.
#      - the client wants a script that will parse the text from the email and create a csv
#        so its easy to copy all trades into a tracking list 
#
#
#  Exercise:
#     * Create a program that will output a file with a list of trades listed in the email body.
#     * The output file should have the following columns:
#       symbol, trade_type, entry_price, stop_loss_price, target_price     
#
#  Hint/Suggestion

#     1 - first create a dictinary with all trades. Each trade is a dictionary and all dictionaries
#       are in a list
#     2 - use the dictionary to create the file

import pdb
import pprint

resource_file_path = '.\\Exercise3\\example_email1.txt'
result_file_path = '.\\Exercise3\\output.csv'

with open(resource_file_path, 'r') as r:
    all_trades_raw = r.read()

def raw_string_to_dictionary(input_string):
    
    input_as_a_list = input_string.split('\n\n') # converting multiline string into a list, consisting  
                                                 # of blocks, one for each position
    all_trades = []                     # this list is to be a final output of the function
    for trade in input_as_a_list:       
        trade_split = trade.split()     # creating a sublist from every block, consisting of a separate words

        trade_dictionary = {                  # using parameters defined above we make a dictionary which is the convenient
            'symbol': trade_split[0],                 # way to interpret every block given as the input of function
            'trade_type': trade_split[1],
            'entry_price': trade_split[2],
            'stop_loss_price': trade_split[5],
            'target_price': trade_split[7]
        }
        all_trades.append(trade_dictionary)   # append every "dictionary/block" into resulting list, as mentioned in Hints, part 1

    return all_trades

def create_trades_file(output_path, trades):

    """
    :param output_path: expect a full path of the file to be created
    :param trades: a list of trades
    :return:
    """

    with open(output_path, 'w') as  f:
        f.write('symbol, trade_type, entry_price, stop_loss_price, target_price\n')
        for i in trades:
            f.write(f'{i['symbol']},{i['trade_type']},{i['entry_price']},{i['stop_loss_price']},{i['target_price']}\n')
        

all_trades_formatted = raw_string_to_dictionary(all_trades_raw)
create_trades_file(result_file_path, all_trades_formatted)